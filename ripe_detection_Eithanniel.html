<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ripe Detection — Eithanniel XII-4</title>

    <!-- TensorFlow & Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@700;800&display=swap" rel="stylesheet">

    <style>
        :root{
            --bg1: #0f172a;
            --bg2: #0b1220;
            --card: rgba(255,255,255,0.03);
            --glass: rgba(255,255,255,0.04);
            --accent: #22c1c3;
            --accent2: #fdbb2d;
            --muted: #9aa4b2;
            --success: #10b981;
            --danger: #ef4444;
            color-scheme: dark;
        }

        html,body{height:100%;overflow-x:hidden;}
        body{
            margin:0;
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #0f0c29);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            padding:24px;
            color:#e6eef6;
            min-height:100vh;
            position:relative;
            overflow:hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Animated background orbs */
        body::before, body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            z-index: -1;
            animation: orbFloat 20s ease-in-out infinite;
        }
        body::before {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, #ff006e 0%, #8338ec 50%, transparent 70%);
            top: -200px;
            left: -150px;
            animation-delay: 0s;
        }
        body::after {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #00f5d4 0%, #00bbf9 50%, transparent 70%);
            bottom: -150px;
            right: -100px;
            animation-delay: -10s;
        }
        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(50px, 30px) scale(1.1); }
            50% { transform: translate(20px, -40px) scale(0.95); }
            75% { transform: translate(-30px, 20px) scale(1.05); }
        }

        /* Extra floating orbs via box-shadows on a pseudo element */
        .bg-orbs {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        .bg-orbs .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.4;
            animation: orbDrift 25s ease-in-out infinite;
        }
        .bg-orbs .orb:nth-child(1) {
            width: 350px; height: 350px;
            background: linear-gradient(135deg, #f72585, #7209b7);
            top: 30%; left: 60%;
            animation-delay: -5s;
        }
        .bg-orbs .orb:nth-child(2) {
            width: 280px; height: 280px;
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
            top: 60%; left: 20%;
            animation-delay: -12s;
        }
        .bg-orbs .orb:nth-child(3) {
            width: 200px; height: 200px;
            background: linear-gradient(135deg, #fee440, #f15bb5);
            top: 10%; left: 40%;
            animation-delay: -18s;
        }
        .bg-orbs .orb:nth-child(4) {
            width: 320px; height: 320px;
            background: linear-gradient(135deg, #06d6a0, #118ab2);
            top: 70%; left: 70%;
            animation-delay: -8s;
        }
        @keyframes orbDrift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(40px, -60px) rotate(120deg); }
            66% { transform: translate(-50px, 40px) rotate(240deg); }
        }

        /* Sparkle particles */
        .particles {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: -1;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 40% 70%, rgba(255,255,255,0.6), transparent),
                radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.9), transparent),
                radial-gradient(2px 2px at 60% 20%, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,0.5), transparent),
                radial-gradient(1px 1px at 80% 10%, rgba(255,255,255,0.9), transparent),
                radial-gradient(2px 2px at 30% 50%, rgba(255,255,255,0.6), transparent);
            background-size: 550px 550px;
            animation: sparkle 80s linear infinite;
        }
        @keyframes sparkle {
            from { background-position: 0 0; }
            to { background-position: 1100px 1100px; }
        }

        /* Hero header / sign */
        .hero{
            text-align:center;
            margin-bottom:28px;
            animation: fadeInDown .6s ease-out;
        }
        .hero h1{
            font-family:'Poppins',sans-serif;
            font-size:clamp(28px,5vw,42px);
            font-weight:800;
            margin:0;
            background:linear-gradient(90deg,var(--accent),#6ee7b7,var(--accent2));
            background-size:200% auto;
            -webkit-background-clip:text;
            background-clip:text;
            -webkit-text-fill-color:transparent;
            animation:shimmer 3s linear infinite;
        }
        .hero .badge{
            display:inline-block;
            margin-top:8px;
            padding:6px 16px;
            font-size:13px;
            font-weight:600;
            letter-spacing:1px;
            border-radius:999px;
            background:rgba(255,255,255,0.06);
            color:var(--muted);
            border:1px solid rgba(255,255,255,0.08);
        }
        @keyframes shimmer{
            to{background-position:200% center}
        }
        @keyframes fadeInDown{
            from{opacity:0;transform:translateY(-18px)}
            to{opacity:1;transform:translateY(0)}
        }

        .container{
            width:100%;
            max-width:920px;
            background: linear-gradient(180deg, rgba(255,255,255,0.025), rgba(255,255,255,0.01));
            border-radius:20px;
            box-shadow: 0 12px 40px rgba(2,6,23,0.55), 0 0 0 1px rgba(255,255,255,0.04);
            display:grid;
            grid-template-columns: 1fr 360px;
            gap:24px;
            padding:26px;
            align-items:start;
            animation: fadeIn .5s ease-out;
        }
        @keyframes fadeIn{from{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}

        /* Mouse-reactive glow effect */
        .container{
            position:relative;
            overflow:hidden;
            transition: transform .15s ease-out, box-shadow .2s ease;
            --glow-x: 50%;
            --glow-y: 50%;
        }
        .container::before{
            content:'';
            position:absolute;
            width:500px;
            height:500px;
            left:var(--glow-x, 50%);
            top:var(--glow-y, 50%);
            background:radial-gradient(circle, rgba(34,193,195,0.18) 0%, rgba(110,231,183,0.08) 40%, transparent 70%);
            pointer-events:none;
            transform:translate(-50%,-50%);
            opacity:0;
            transition:opacity .4s ease;
            z-index:0;
        }
        .container:hover::before{opacity:1;}
        .container.tilt{transform:perspective(1000px) rotateX(var(--rotateX)) rotateY(var(--rotateY));}
        .container > *{position:relative;z-index:1;}

        /* Floating animation for hero */
        .hero{
            animation: fadeInDown .6s ease-out, float 4s ease-in-out infinite;
        }
        @keyframes float{
            0%,100%{transform:translateY(0)}
            50%{transform:translateY(-6px)}
        }

        /* Button hover effects */
        .btn{
            transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
        }
        .btn:hover{
            transform:translateY(-2px) scale(1.02);
            box-shadow:0 6px 20px rgba(34,193,195,0.3);
            filter:brightness(1.1);
        }
        .btn:active{transform:translateY(0) scale(0.98);}

        /* Card hover lift */
        .card{
            transition: transform .2s ease, box-shadow .25s ease;
        }
        .card:hover{
            transform:translateY(-3px);
            box-shadow:0 8px 25px rgba(0,0,0,0.2);
        }

        /* Dropzone pulse on hover */
        .dropzone{
            transition: border-color .18s, transform .12s, box-shadow .25s ease;
        }
        .dropzone:hover{
            border-color:rgba(34,193,195,0.5);
            box-shadow:0 0 20px rgba(34,193,195,0.1);
        }

        /* Progress bar animation */
        .bar > i{
            transition: width .4s cubic-bezier(.4,0,.2,1);
            animation: barGlow 2s ease-in-out infinite;
        }
        @keyframes barGlow{
            0%,100%{filter:brightness(1)}
            50%{filter:brightness(1.2)}
        }

        /* Badge pulse */
        .hero .badge{
            animation: badgePulse 3s ease-in-out infinite;
        }
        @keyframes badgePulse{
            0%,100%{box-shadow:0 0 0 0 rgba(34,193,195,0.4)}
            50%{box-shadow:0 0 0 8px rgba(34,193,195,0)}
        }

        /* Prediction row stagger animation */
        .pred{
            opacity:0;
            animation: slideIn .35s ease forwards;
        }
        @keyframes slideIn{
            from{opacity:0;transform:translateX(-12px)}
            to{opacity:1;transform:translateX(0)}
        }

        /* Top result glow */
        .top-result{
            transition: background .3s ease, box-shadow .3s ease;
        }
        .top-result:hover{
            box-shadow:0 0 15px rgba(34,193,195,0.2);
        }

        /* Status dot pulse when ready */
        .dot.ready{
            animation: dotPulse 2s ease-in-out infinite;
        }
        @keyframes dotPulse{
            0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.5)}
            50%{box-shadow:0 0 0 6px rgba(16,185,129,0)}
        }

        .left{
            padding:8px 12px;
        }

        h1{margin:0 0 6px 0;font-size:20px}
        p.lead{margin:0 0 16px 0;color:var(--muted)}

        .uploader{
            background:var(--card);
            border-radius:12px;
            padding:14px;
            display:flex;
            gap:12px;
            align-items:center;
            flex-direction:column;
        }

        .dropzone{
            width:100%;
            border:2px dashed rgba(255,255,255,0.06);
            border-radius:10px;
            padding:14px;
            display:flex;
            gap:12px;
            align-items:center;
            justify-content:center;
            min-height:220px;
            background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
            transition: border-color .18s, transform .12s;
        }

        .dropzone.dragover{border-color: rgba(34,193,195,0.9); transform: translateY(-2px)}

        .preview{
            width:100%;
            max-width:100%;
            height:220px;
            border-radius:8px;
            overflow:hidden;
            background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            display:flex;
            align-items:center;
            justify-content:center;
        }

        .preview img{ width:100%; height:100%; object-fit:cover; display:block }
        .placeholder{color:var(--muted); font-size:14px}

        .controls{width:100%; display:flex; gap:8px; margin-top:10px}
        .btn{
            flex:1; padding:10px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:600;
            background:linear-gradient(90deg,var(--accent), #6ee7b7); color:#042027;
        }

        .sidebar{padding:10px 12px;}
        .card{background:var(--glass); border-radius:12px; padding:12px}

        .status{display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted)}
        .dot{width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.06)}
        .dot.ready{background:var(--success)}

        .predictions{margin-top:12px; display:flex; flex-direction:column; gap:8px}
        .pred{display:flex; gap:8px; align-items:center}
        .pred .label{flex:0 0 110px; font-size:13px}
        .bar{flex:1; height:10px; background:rgba(255,255,255,0.04); border-radius:999px; overflow:hidden}
        .bar > i{display:block; height:100%; background:linear-gradient(90deg,var(--accent), #8ed7e6)}
        .percent{width:48px; text-align:right; font-size:12px; color:var(--muted)}

        .top-result{margin-top:12px; padding:10px; border-radius:10px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); display:flex; align-items:center; justify-content:space-between}

        .spinner{width:18px; height:18px; border:3px solid rgba(255,255,255,0.06); border-top-color:var(--accent); border-radius:50%; animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        @media (max-width:880px){
            .container{grid-template-columns:1fr;}
            .sidebar{order:3}
        }
    </style>
</head>

<body>

<!-- Animated background elements -->
<div class="particles"></div>
<div class="bg-orbs">
    <div class="orb"></div>
    <div class="orb"></div>
    <div class="orb"></div>
    <div class="orb"></div>
</div>

<header class="hero">
    <h1>Ripe Detection</h1>
    <span class="badge">Eithanniel XII-4</span>
</header>

<div class="container" role="main">
    <div class="left">
        <h1>Image Recognition</h1>
        <p class="lead">Upload or drag an image to get predictions from the model.</p>

        <div class="uploader card">
            <div id="dropzone" class="dropzone" tabindex="0" aria-label="Drop image here or click to select">
                <div class="preview" id="previewBox">
                    <div class="placeholder" id="placeholder">No image selected</div>
                    <img id="preview" alt="Preview image" style="display:none">
                </div>
            </div>

            <div class="controls">
                <input id="fileInput" type="file" accept="image/*" style="display:none">
                <button id="chooseBtn" class="btn">Choose Image</button>
                <button id="clearBtn" class="btn" style="background:transparent;color:var(--muted);font-weight:600;border:1px solid rgba(255,255,255,0.04)">Clear</button>
            </div>

            <div style="width:100%; display:flex; justify-content:space-between; margin-top:10px">
                <div class="status"><div id="modelDot" class="dot"></div><div id="modelText">Loading model...</div></div>
                <div class="status"><div style="font-size:12px;color:var(--muted)">Model: <strong style="color:#dff6f6">Teachable Machine</strong></div></div>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <div class="card">
            <div style="display:flex; align-items:center; justify-content:space-between">
                <strong>Top prediction</strong>
                <div id="busy" style="visibility:hidden"><div class="spinner" aria-hidden></div></div>
            </div>

            <div id="topResult" class="top-result" style="margin-top:8px">No result yet</div>

            <div style="margin-top:12px"><strong>All predictions</strong></div>
            <div id="predictions" class="predictions"></div>
        </div>
    </aside>
</div>

<script>
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/roxBxzJ3j/";
    let model = null;

    // DOM
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const chooseBtn = document.getElementById('chooseBtn');
    const clearBtn = document.getElementById('clearBtn');
    const preview = document.getElementById('preview');
    const placeholder = document.getElementById('placeholder');
    const previewBox = document.getElementById('previewBox');
    const modelDot = document.getElementById('modelDot');
    const modelText = document.getElementById('modelText');
    const predictionsEl = document.getElementById('predictions');
    const topResult = document.getElementById('topResult');
    const busy = document.getElementById('busy');

    // Load model
    async function loadModel(){
        try{
            model = await tmImage.load(MODEL_URL + 'model.json', MODEL_URL + 'metadata.json');
            modelDot.classList.add('ready');
            modelText.textContent = 'Model ready';
            console.log('Model loaded');
        }catch(err){
            modelDot.style.background = 'var(--danger)';
            modelText.textContent = 'Failed to load model';
            console.error('Model load error', err);
        }
    }
    loadModel();

    // Helpers
    function showBusy(on){ busy.style.visibility = on ? 'visible' : 'hidden'; }

    function clearPreview(){
        preview.src = '';
        preview.style.display = 'none';
        placeholder.style.display = 'block';
        predictionsEl.innerHTML = '';
        topResult.textContent = 'No result yet';
    }

    function handleFile(file){
        if(!file) return;
        const url = URL.createObjectURL(file);
        placeholder.style.display = 'none';
        preview.style.display = 'block';
        preview.src = url;
        preview.onload = () => predictImage(preview);
    }

    async function predictImage(imgElement){
        if(!model){ alert('Model belum siap'); return; }
        showBusy(true);
        try{
            const predictions = await model.predict(imgElement, false);
            // Sort descending
            predictions.sort((a,b) => b.probability - a.probability);

            // Top
            const best = predictions[0];
            topResult.innerHTML = `<div style=\"display:flex;flex-direction:column\"><strong>${best.className}</strong><small style=\"color:var(--muted)\">${(best.probability*100).toFixed(2)}%</small></div>`;

            // All predictions
            predictionsEl.innerHTML = '';
            predictions.forEach(p => {
                const row = document.createElement('div'); row.className = 'pred';
                const label = document.createElement('div'); label.className = 'label'; label.textContent = p.className;
                const barWrap = document.createElement('div'); barWrap.className = 'bar';
                const bar = document.createElement('i'); bar.style.width = (p.probability*100) + '%';
                barWrap.appendChild(bar);
                const percent = document.createElement('div'); percent.className = 'percent'; percent.textContent = (p.probability*100).toFixed(2) + '%';
                row.appendChild(label); row.appendChild(barWrap); row.appendChild(percent);
                predictionsEl.appendChild(row);
            });
        }catch(err){
            console.error(err); alert('Error saat memproses gambar');
        }finally{ showBusy(false); }
    }

    // Drag & drop
    ['dragenter','dragover'].forEach(evt => dropzone.addEventListener(evt, (e)=>{ e.preventDefault(); dropzone.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(evt => dropzone.addEventListener(evt, (e)=>{ e.preventDefault(); dropzone.classList.remove('dragover'); }));

    dropzone.addEventListener('drop', (e)=>{
        const file = e.dataTransfer.files[0];
        if(file && file.type.startsWith('image/')) handleFile(file);
    });

    // Click to open file dialog
    dropzone.addEventListener('click', ()=> fileInput.click());
    chooseBtn.addEventListener('click', ()=> fileInput.click());
    clearBtn.addEventListener('click', clearPreview);

    fileInput.addEventListener('change', (e)=> handleFile(e.target.files[0]));

    // keyboard accessibility
    dropzone.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') fileInput.click(); });

    // initialize
    clearPreview();

    // ===== MOUSE-REACTIVE EFFECTS =====
    const container = document.querySelector('.container');

    // Tilt effect on mouse move
    container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        // Calculate rotation (max ±4 degrees)
        const rotateY = ((x - centerX) / centerX) * 4;
        const rotateX = ((centerY - y) / centerY) * 4;

        container.style.setProperty('--rotateX', rotateX + 'deg');
        container.style.setProperty('--rotateY', rotateY + 'deg');
        container.classList.add('tilt');

        // Move glow to cursor position
        container.style.setProperty('--glow-x', x + 'px');
        container.style.setProperty('--glow-y', y + 'px');
    });

    container.addEventListener('mouseleave', () => {
        container.classList.remove('tilt');
        container.style.setProperty('--rotateX', '0deg');
        container.style.setProperty('--rotateY', '0deg');
    });

    // Add stagger animation delay to prediction rows
    const originalPredictImage = predictImage;
    predictImage = async function(imgElement) {
        await originalPredictImage(imgElement);
        // Add stagger delays to prediction rows
        document.querySelectorAll('.pred').forEach((row, i) => {
            row.style.animationDelay = (i * 0.08) + 's';
        });
    };
</script>

</body>
</html>